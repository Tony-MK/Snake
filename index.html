<!DOCTYPE html>
<html>
<head>
	<title>Snake</title>
	<style type="text/css">
		body{
			margin:0;
		}
		canvas{
			border-width: 2px;
			border-style: solid;
			width:  99vw;
			height: 99vh;
		}
	</style>
</head>
<body>

</body>
<script type="text/javascript">
	const FPS = 60;
	const SPEED = 0.1/FPS; 
	
	class Game{
		constructor(){
			this.score = 0
			this.canvas = document.createElement("canvas");
			document.body.insertBefore(this.canvas,document.body.childNodes[0]);
			this.context = this.canvas.getContext('2d');
			this.drawText("Snake");

			this.interval = undefined;
			
		}
		postion(n,y){
		return y ? parseInt(this.canvas.height*(n)) : parseInt(this.canvas.width*(n))
		}

		drawText(text,x,y,size){
			if (size === undefined){
				console.log(size+"px Arial")
				this.context.font = "30px Arial";
			}else{
				console.log(size+"px Arial")
				this.context.font = size+"px Arial";
			}
			this.context.textAlign = "center";
			this.context.fillStyle = "#000";
			if(x === undefined){
				this.context.fillText(text,this.postion(.5),this.postion(.5,true));
				return;
			}
			this.context.fillText(text,x,y)
			return
			
		}

		update(){
			
			apple.update();
			snake.update();
		}
		end(){
			console.log(this.score)
			clearInterval(this.interval);
			this.drawText("GAME OVER")
		}
		clearCanvas(){
			this.context.clearRect(0,0, this.canvas.width, this.canvas.height);

		}
		reset(){
			clearInterval(this.interval);
			this.score = 0;

		}

		start(){

			this.clearCanvas()
			snake = new Snake();

			apple = new Apple();
			
			this.interval = setInterval(this.update,FPS);
		}
	}
	

	class Component{
		constructor(x,y,w,h,color){

			this.width= w;
			this.height = h;
			this.x = x;
			this.y = y;
			this.draw();

		}

		draw(){
			game.context.fillStyle = "#090"
			game.context.fillRect(this.x,this.y,this.width,this.height);

		}
		clear(){

			game.context.clearRect(this.x,this.y,this.width,this.height)
		}


	}
	class Apple{
		constructor(){
			this.raduis= 3;
			this.x = game.canvas.width/2;
			this.y = game.canvas.height/2;
			this.draw();

			


		}
		draw(){
			game.context.beginPath();
			game.context.arc(this.x,this.y, this.raduis, 0, 2 * Math.PI);
			game.context.fillStyle = "#900";
			game.context.fill();
		}
		update(){
			

			if(snake.body[0].x+snake.width > this.x && this.x > snake.body[0].x-snake.width && 
				snake.body[0].y+snake.height > this.y && this.y > snake.body[0].y-snake.height){

				game.clearCanvas();

				game.score += 1;
				game.drawText(game.score,Math.floor(game.canvas.width*0.9),Math.floor(game.canvas.height*0.1),10);
				
				


				this.x = Math.random() * game.canvas.width;
				this.y = Math.random() * game.canvas.height;
				this.draw();

				
				snake.addWeight(1);
							



			}
			
		}



	}
	class Snake{
		
		body_size = 0;
		constructor(){
			
			

			this.width = 10;
			this.height = 10;
			this.speed = 1;
			this.xVel = this.speed;
			this.yVel = 0;
			this.body = Array(new Component(80,20,this.width,this.height));
			this.addWeight(3);

			document.addEventListener("keydown",(e) => {
				e.preventDefault();
				console.log(e.keyCode)
				switch(e.keyCode){
					case 32:
						if (game.score > 0){
							game.reset();
						}else{
							game.start();
						}
						break;
					case 37:
						if (this.xVel > 0){break;}
						this.xVel = -this.speed;
						this.yVel = 0;
						break;


					case 38:
						if (this.yVel > 0){break;}
						this.xVel = 0;
						this.yVel =  -this.speed;
						break;

					case 39:
						if (this.xVel < 0){break;}
						this.xVel = this.speed;
						this.yVel = 0;
						break; 
					case 40:
						if (this.yVel < 0){break;}
						this.xVel = 0;
						this.yVel = this.speed;
						break;

					default:
						console.log(e.keyCode);
						break;
				}
			});
		}
		addWeight(n){
			while (n > 0) {
				this.body.push(
					new Component(
						this.body[this.body_size].x-10,
						this.body[this.body_size].y,
						this.width,
						this.height,
					)
				);
				this.body_size++
				n--;
			}
			
		}
		
		update(){
			this.body[this.body_size].clear();

			this.body[this.body_size].x = this.body[0].x+Math.floor(this.width *this.xVel);
			this.body[this.body_size].y = this.body[0].y+Math.floor(this.height*this.yVel);



			


			

			this.body[this.body_size].draw();
			let head = this.body[this.body_size];
			this.body.pop();
			this.body.unshift(head);

			if(this.body[0].x < 0 || this.body[0].x > game.canvas.width || this.body[0].y < 0 || this.body[0].y > game.canvas.height){
				game.end()
			}

			for (var i = this.body.length -1; i > 0; i--) {
				if(this.body[i].x === this.body[0].x && this.body[i].y === this.body[0].y){
					this.body[this.body_size].fillStyle = "#090";
					game.end();
				}
			}


				

		

			

			
		}
	}

	var game = new Game();
	let snake  = new Snake();
	let apple = new Apple()

	game.start();

</script>
</html>