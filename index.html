<!DOCTYPE html>
<html>
<head>
	<title>Snake</title>
	<style type="text/css">
		body{
			margin:0;
		}
	</style>
</head>
<body>

</body>
<script type="text/javascript">
	const SPEED = 1; 
	class Game{
		constructor(){
			this.canvas = document.createElement("canvas");
			this.canvas.height = 100;
			this.canvas.width  = 400;
			document.body.insertBefore(this.canvas,document.body.childNodes[0]);
			this.context = this.canvas.getContext('2d');
			
		}

		update(){
			apple.clear()
			if(snake.body[0].x === apple.x && snake.body[0].y === apple.y){
				apple.x = Math.random() * game.canvas.width
				apple.y = Math.random() * game.canvas.height;
				snake.addWeight();
			}
			apple.draw();
			snake.update();
		}
		end(){
			clearInterval(this.interval)
			document.body.innerHTML = "Game Ended"
		}
		start(){
			this.interval = setInterval(this.update,60);
		}
	}
	

	class Component{
		constructor(x,y,w,h,color){

			this.width= w;
			this.height = h;
			this.x = x;
			this.y = y;
			this.color = color;
			this.draw();

		}

		draw(){
			game.context.fillStyle = this.color;
			game.context.fillRect(this.x,this.y,this.width,this.height);

			
		}
		clear(){
			game.context.clearRect(this.x,this.y,this.width,this.height)
		}


	}
	class Apple extends Component{
		constructor(){
			super(game.canvas.width/2,game.canvas.height/2,10,10,"#009");
		}


	}
	class Snake{
		
		body_size = 0;
		constructor(){
			
			
			
			this.width = 10;
			this.height = 10;
			this.xVel = 1;
			this.yVel = 0;

			this.body = Array(new Component(20,20,this.width,this.height),new Component(21,21,this.width,this.height),new Component(22,22,this.width,this.height));
			this.addWeight();
			document.addEventListener("keydown",(e) => {
				console.log(e.keyCode);
				e.preventDefault();
				switch(e.keyCode){
					case 37:
						this.xVel = -SPEED;
						this.yVel = 0;
						break;
					case 38:
						this.xVel = 0;
						this.yVel =  -SPEED;
						break;

					case 39:
						this.xVel = SPEED;
						this.yVel = 0;
						break; 
					case 40:
						this.xVel = 0;
						this.yVel = SPEED;
						break;

					default:
						console.log(e.keyCode);
						break;
				}
			});
		}
		addWeight(){
			this.body.push(
					new Component(
						this.body[this.body_size].x,
						this.body[this.body_size].y,
						this.width,
						this.height,
					)
				);
			this.body_size++
		}
		update(){
				

			this.body[this.body_size].clear();
			this.body[this.body_size].x = this.body[0].x + this.xVel;
			this.body[this.body_size].y = this.body[0].y + this.yVel;



			if(this.body[this.body_size].x < 0){
				this.body[this.body_size].x = game.canvas.width
			}
			if(this.body[this.body_size].x > game.canvas.width){
				this.body[this.body_size].x = 0
			}

			if(this.body[this.body_size].y < 0){
				this.body[this.body_size].y = game.canvas.height
			}
			if(this.body[this.body_size].y > game.canvas.height){
				this.body[this.body_size].y = 0
			}


			let head = this.body[this.body_size];
			this.body.pop();
			this.body.unshift(head);

			this.body[this.body_size].draw();


			for (var i = this.body.length -1; i > 0; i--) {
				if(this.body[i].x === this.body[0].x && this.body[i].y === this.body[0].y){
					console.log(i);
					console.log()
					game.end();
				}
			}	

		

			

			
		}
	}

	var game = new Game();
	let snake  = new Snake(0,0,10,10);
	let apple = new Apple()

	game.start();

</script>
</html>